import getPositionFromHotspot, {
  getCroppedImageSrc,
} from "@/sanity/sanity.query";
import type { SanityImageQueryResult } from "@/types";
import ButtonLink from "./common/ButtonLink";
import GradientLineThick from "./assets/GradientLineThick";
import GradientLineVerticalThick from "./assets/GradientLineVerticalThick";
import { MapProvider } from "@/components/providers/map-provider";
import { MapComponent } from "@/components/Map";
import Image from "next/image";
import { removelineBreakCodeFromHTML } from "./utils/lineBreaks";
import { getTextWithLineBreaks } from "./utils/getTextWithLineBreaks";
import ButtonLinkNew from "./common/ButtonLinkNew";
import mapMarker from "../app/(site)/assets/images/marker.png";
import { PortableText } from "@portabletext/react";

export default function InnerHero({
  title,
  sectionTitle,
  imageAltText,
  image,
  pageNumber,
  imageCaptionText,
}: {
  title: string;
  sectionTitle: string;
  imageAltText?: string;
  image?: SanityImageQueryResult | undefined;
  pageNumber?: string;
  imageCaptionText?: any;
}) {
  return (
    <section
      className={`mt-[7rem] xsmall:mt-[10rem] small:mt-0 ${imageCaptionText && "pb-[2rem] small:pb-0"}`}
    >
      <div className="gap-10 max-w-[1440px] small:flex small:justify-between small:mr-0 small:ml-auto  small:mt-[104px] small:gap-0 medium:mx-auto small:pt-[3rem]">
        <div className="text-theme-dark text-center pt-[5.5rem] mx-auto xsmall:ml-0 xsmall:pt-[4rem] small:text-left small:pt-0 small:mt-[6rem] small:max-w-full ">
          {/* xsmall:text-left */}
          <h3 className="uppercase font-semibold  small:ml-layout-small">
            {/* xsmall:ml-[7.5rem] */}
            {removelineBreakCodeFromHTML(sectionTitle)}
          </h3>
          <div className="w-full order-last small:order-first px-[5%] small:px-0">
            <div className="w-full relative pl-0 small:pr-0 xsmall:mt-[4rem] xsmall:pb-[3rem] xsmall:text-[clamp(3.5rem,6.3vw,4rem)] small:text-[clamp(3.2rem,2.8vw,4rem)] large:static pb-12 small:pl-layout-small">
              {/* xsmall:pl-[3.7rem] */}
              <h1 className="absolute -left-5 hidden xsmall:block xsmall:-translate-x-[5.3vw] small:-translate-x-0 w-fit h-auto font-body small:top-0 large:top-[26rem] mt-[0.1rem] ">
                {pageNumber}
              </h1>

              {/* NOTE: if/else for variable line breaks in cms. see also small:pr-[clamp(...)] which may be individual per page */}

              {/* desktop has line breaks... */}
              <h1 className="inner__hero__title pt-[3rem] mx-auto max-w-[383px] font-bold pb-[2rem] xsmall:max-w-[80%] xsmall:pt-0 xsmall:pb-0 small:ml-0 small:w-[clamp(400px,43vw,558px)] small:pr-[2rem]">
                {title && getTextWithLineBreaks(title)}
              </h1>
            </div>
          </div>
          {pageNumber !== "06" && (
            <div className="w-full mx-auto px-[8%] xsmall:px-0 pb-[5rem] xsmall:pb-[6.5rem] xsmall:w-fit xsmall:mx-auto small:ml-layout-small">
              {/* xsmall:ml-[7.5rem] */}
              <ButtonLinkNew
                theme="dark"
                text="Get in touch"
                destination="/contact"
                ctaType="general"
                hoverEffect="fill-col"
              />
            </div>
          )}
        </div>
        <div className="relative w-full mx-[390/408] aspect-square xsmall:px-0 xsmall:aspect-[744/408] small:aspect-[704/480] small:w-full small:h-auto small:max-w-[704px] small:mr-0">
          {pageNumber === "06" && (
            <div className="z-10 absolute left-[6%] top-[38.5%] w-[clamp(119px,34%,192px)] xsmall:left-[23.7%] xsmall:top-[35%] xsmall:w-[clamp(113px,20%,192px)] small:top-[37%] small:left-[16%] small:w-[clamp(100px,27%,192px)] h-auto">
              <svg
                viewBox="0 0 194 52"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <rect
                  width="194"
                  height="52"
                  rx="2"
                  transform="matrix(1 0 0 -1 0 52)"
                  fill="url(#paint0_linear_2601_10951)"
                />
                <path
                  d="M170 41.4167C169.755 41.4191 169.516 41.3432 169.317 41.2C168.817 40.8833 157.083 33 157.083 23.4167C157.083 19.991 158.444 16.7055 160.867 14.2832C163.289 11.8609 166.574 10.5 170 10.5C173.426 10.5 176.711 11.8609 179.134 14.2832C181.556 16.7055 182.917 19.991 182.917 23.4167C182.917 33 171.25 40.8833 170.683 41.2C170.485 41.3432 170.245 41.4191 170 41.4167ZM170 13.0833C167.249 13.0745 164.607 14.1577 162.654 16.0951C160.701 18.0325 159.597 20.6657 159.583 23.4167C159.583 30.4333 167.567 36.85 170 38.6333C172.433 36.85 180.417 30.4333 180.417 23.4167C180.404 20.6657 179.299 18.0325 177.346 16.0951C175.393 14.1577 172.751 13.0745 170 13.0833Z"
                  fill="white"
                />
                <path
                  d="M170 27.2502C169.094 27.2502 168.208 26.9814 167.454 26.4777C166.7 25.9741 166.113 25.2583 165.766 24.4208C165.419 23.5833 165.328 22.6617 165.505 21.7727C165.682 20.8836 166.118 20.0669 166.759 19.4259C167.4 18.7849 168.217 18.3484 169.106 18.1716C169.995 17.9947 170.917 18.0855 171.754 18.4324C172.592 18.7793 173.308 19.3667 173.811 20.1205C174.315 20.8742 174.584 21.7603 174.584 22.6668C174.584 23.8824 174.101 25.0482 173.241 25.9077C172.382 26.7673 171.216 27.2502 170 27.2502ZM170 20.5835C169.588 20.5835 169.185 20.7057 168.843 20.9346C168.5 21.1635 168.233 21.4889 168.076 21.8696C167.918 22.2503 167.877 22.6691 167.957 23.0733C168.037 23.4774 168.236 23.8486 168.527 24.14C168.819 24.4313 169.19 24.6297 169.594 24.7101C169.998 24.7905 170.417 24.7493 170.798 24.5916C171.178 24.4339 171.504 24.1669 171.733 23.8243C171.961 23.4817 172.084 23.0789 172.084 22.6668C172.084 22.1143 171.864 21.5844 171.473 21.1937C171.083 20.803 170.553 20.5835 170 20.5835Z"
                  fill="white"
                />
                <path
                  d="M16.3886 30V20.2H20.6306C21.5079 20.2 22.2639 20.3447 22.8986 20.634C23.5332 20.914 24.0232 21.32 24.3686 21.852C24.7139 22.384 24.8866 23.0187 24.8866 23.756C24.8866 24.484 24.7139 25.114 24.3686 25.646C24.0232 26.1687 23.5332 26.57 22.8986 26.85C22.2639 27.13 21.5079 27.27 20.6306 27.27H17.6486L18.6566 26.276V30H16.3886ZM22.6186 30L20.1686 26.444H22.5906L25.0686 30H22.6186ZM18.6566 26.528L17.6486 25.464H20.5046C21.2046 25.464 21.7272 25.3147 22.0726 25.016C22.4179 24.708 22.5906 24.288 22.5906 23.756C22.5906 23.2147 22.4179 22.7947 22.0726 22.496C21.7272 22.1973 21.2046 22.048 20.5046 22.048H17.6486L18.6566 20.97V26.528ZM31.4435 30.168C30.6688 30.168 29.9502 30.042 29.2875 29.79C28.6342 29.538 28.0648 29.1833 27.5795 28.726C27.1035 28.2687 26.7302 27.732 26.4595 27.116C26.1982 26.5 26.0675 25.828 26.0675 25.1C26.0675 24.372 26.1982 23.7 26.4595 23.084C26.7302 22.468 27.1082 21.9313 27.5935 21.474C28.0788 21.0167 28.6482 20.662 29.3015 20.41C29.9548 20.158 30.6642 20.032 31.4295 20.032C32.2042 20.032 32.9135 20.158 33.5575 20.41C34.2108 20.662 34.7755 21.0167 35.2515 21.474C35.7368 21.9313 36.1148 22.468 36.3855 23.084C36.6562 23.6907 36.7915 24.3627 36.7915 25.1C36.7915 25.828 36.6562 26.5047 36.3855 27.13C36.1148 27.746 35.7368 28.2827 35.2515 28.74C34.7755 29.188 34.2108 29.538 33.5575 29.79C32.9135 30.042 32.2088 30.168 31.4435 30.168ZM31.4295 28.236C31.8682 28.236 32.2695 28.1613 32.6335 28.012C33.0068 27.8627 33.3335 27.648 33.6135 27.368C33.8935 27.088 34.1082 26.7567 34.2575 26.374C34.4162 25.9913 34.4955 25.5667 34.4955 25.1C34.4955 24.6333 34.4162 24.2087 34.2575 23.826C34.1082 23.4433 33.8935 23.112 33.6135 22.832C33.3428 22.552 33.0208 22.3373 32.6475 22.188C32.2742 22.0387 31.8682 21.964 31.4295 21.964C30.9908 21.964 30.5848 22.0387 30.2115 22.188C29.8475 22.3373 29.5255 22.552 29.2455 22.832C28.9655 23.112 28.7462 23.4433 28.5875 23.826C28.4382 24.2087 28.3635 24.6333 28.3635 25.1C28.3635 25.5573 28.4382 25.982 28.5875 26.374C28.7462 26.7567 28.9608 27.088 29.2315 27.368C29.5115 27.648 29.8382 27.8627 30.2115 28.012C30.5848 28.1613 30.9908 28.236 31.4295 28.236ZM41.716 30.168C40.932 30.168 40.1807 30.0653 39.462 29.86C38.7433 29.6453 38.1647 29.37 37.726 29.034L38.496 27.326C38.916 27.6247 39.4107 27.872 39.98 28.068C40.5587 28.2547 41.142 28.348 41.73 28.348C42.178 28.348 42.5373 28.306 42.808 28.222C43.088 28.1287 43.2933 28.0027 43.424 27.844C43.5547 27.6853 43.62 27.5033 43.62 27.298C43.62 27.0367 43.5173 26.8313 43.312 26.682C43.1067 26.5233 42.836 26.3973 42.5 26.304C42.164 26.2013 41.7907 26.108 41.38 26.024C40.9787 25.9307 40.5727 25.8187 40.162 25.688C39.7607 25.5573 39.392 25.3893 39.056 25.184C38.72 24.9787 38.4447 24.708 38.23 24.372C38.0247 24.036 37.922 23.6067 37.922 23.084C37.922 22.524 38.0713 22.0153 38.37 21.558C38.678 21.0913 39.1353 20.7227 39.742 20.452C40.358 20.172 41.128 20.032 42.052 20.032C42.668 20.032 43.2747 20.1067 43.872 20.256C44.4693 20.396 44.9967 20.6107 45.454 20.9L44.754 22.622C44.2967 22.3607 43.8393 22.1693 43.382 22.048C42.9247 21.9173 42.4767 21.852 42.038 21.852C41.5993 21.852 41.24 21.9033 40.96 22.006C40.68 22.1087 40.4793 22.244 40.358 22.412C40.2367 22.5707 40.176 22.7573 40.176 22.972C40.176 23.224 40.2787 23.4293 40.484 23.588C40.6893 23.7373 40.96 23.8587 41.296 23.952C41.632 24.0453 42.0007 24.1387 42.402 24.232C42.8127 24.3253 43.2187 24.4327 43.62 24.554C44.0307 24.6753 44.404 24.8387 44.74 25.044C45.076 25.2493 45.3467 25.52 45.552 25.856C45.7667 26.192 45.874 26.6167 45.874 27.13C45.874 27.6807 45.72 28.1847 45.412 28.642C45.104 29.0993 44.642 29.468 44.026 29.748C43.4193 30.028 42.6493 30.168 41.716 30.168ZM52.1137 30.168C51.3577 30.168 50.6531 30.0467 49.9997 29.804C49.3557 29.552 48.7957 29.1973 48.3197 28.74C47.8437 28.2827 47.4704 27.746 47.1997 27.13C46.9384 26.514 46.8077 25.8373 46.8077 25.1C46.8077 24.3627 46.9384 23.686 47.1997 23.07C47.4704 22.454 47.8437 21.9173 48.3197 21.46C48.8051 21.0027 49.3697 20.6527 50.0137 20.41C50.6577 20.158 51.3624 20.032 52.1277 20.032C52.9771 20.032 53.7424 20.1813 54.4237 20.48C55.1144 20.7693 55.6931 21.1987 56.1597 21.768L54.7037 23.112C54.3677 22.7293 53.9944 22.4447 53.5837 22.258C53.1731 22.062 52.7251 21.964 52.2397 21.964C51.7824 21.964 51.3624 22.0387 50.9797 22.188C50.5971 22.3373 50.2657 22.552 49.9857 22.832C49.7057 23.112 49.4864 23.4433 49.3277 23.826C49.1784 24.2087 49.1037 24.6333 49.1037 25.1C49.1037 25.5667 49.1784 25.9913 49.3277 26.374C49.4864 26.7567 49.7057 27.088 49.9857 27.368C50.2657 27.648 50.5971 27.8627 50.9797 28.012C51.3624 28.1613 51.7824 28.236 52.2397 28.236C52.7251 28.236 53.1731 28.1427 53.5837 27.956C53.9944 27.76 54.3677 27.466 54.7037 27.074L56.1597 28.418C55.6931 28.9873 55.1144 29.4213 54.4237 29.72C53.7424 30.0187 52.9724 30.168 52.1137 30.168ZM62.2462 30.168C61.4716 30.168 60.7529 30.042 60.0902 29.79C59.4369 29.538 58.8676 29.1833 58.3822 28.726C57.9062 28.2687 57.5329 27.732 57.2622 27.116C57.0009 26.5 56.8702 25.828 56.8702 25.1C56.8702 24.372 57.0009 23.7 57.2622 23.084C57.5329 22.468 57.9109 21.9313 58.3962 21.474C58.8816 21.0167 59.4509 20.662 60.1042 20.41C60.7576 20.158 61.4669 20.032 62.2322 20.032C63.0069 20.032 63.7162 20.158 64.3602 20.41C65.0136 20.662 65.5782 21.0167 66.0542 21.474C66.5396 21.9313 66.9176 22.468 67.1882 23.084C67.4589 23.6907 67.5942 24.3627 67.5942 25.1C67.5942 25.828 67.4589 26.5047 67.1882 27.13C66.9176 27.746 66.5396 28.2827 66.0542 28.74C65.5782 29.188 65.0136 29.538 64.3602 29.79C63.7162 30.042 63.0116 30.168 62.2462 30.168ZM62.2322 28.236C62.6709 28.236 63.0722 28.1613 63.4362 28.012C63.8096 27.8627 64.1362 27.648 64.4162 27.368C64.6962 27.088 64.9109 26.7567 65.0602 26.374C65.2189 25.9913 65.2982 25.5667 65.2982 25.1C65.2982 24.6333 65.2189 24.2087 65.0602 23.826C64.9109 23.4433 64.6962 23.112 64.4162 22.832C64.1456 22.552 63.8236 22.3373 63.4502 22.188C63.0769 22.0387 62.6709 21.964 62.2322 21.964C61.7936 21.964 61.3876 22.0387 61.0142 22.188C60.6502 22.3373 60.3282 22.552 60.0482 22.832C59.7682 23.112 59.5489 23.4433 59.3902 23.826C59.2409 24.2087 59.1662 24.6333 59.1662 25.1C59.1662 25.5573 59.2409 25.982 59.3902 26.374C59.5489 26.7567 59.7636 27.088 60.0342 27.368C60.3142 27.648 60.6409 27.8627 61.0142 28.012C61.3876 28.1613 61.7936 28.236 62.2322 28.236ZM76.3436 30.168C75.6249 30.168 74.9856 30.0513 74.4256 29.818C73.8656 29.5847 73.4222 29.2673 73.0956 28.866C72.7689 28.4647 72.6056 28.0027 72.6056 27.48C72.6056 26.9947 72.7129 26.5607 72.9276 26.178C73.1422 25.786 73.4829 25.422 73.9496 25.086C74.4162 24.7407 75.0089 24.4047 75.7276 24.078C76.2502 23.8353 76.6609 23.6207 76.9596 23.434C77.2582 23.2473 77.4682 23.07 77.5896 22.902C77.7109 22.7247 77.7716 22.5473 77.7716 22.37C77.7716 22.1273 77.6876 21.9313 77.5196 21.782C77.3609 21.6327 77.1229 21.558 76.8056 21.558C76.4696 21.558 76.2082 21.642 76.0216 21.81C75.8349 21.978 75.7416 22.1927 75.7416 22.454C75.7416 22.594 75.7696 22.734 75.8256 22.874C75.8816 23.0047 75.9889 23.1587 76.1476 23.336C76.3062 23.504 76.5302 23.7233 76.8196 23.994L81.9856 28.782L80.7956 30.168L75.0976 24.876C74.7709 24.5773 74.5096 24.2973 74.3136 24.036C74.1176 23.7747 73.9729 23.518 73.8796 23.266C73.7956 23.014 73.7536 22.7527 73.7536 22.482C73.7536 22.006 73.8796 21.586 74.1316 21.222C74.3836 20.858 74.7382 20.578 75.1956 20.382C75.6529 20.1767 76.1896 20.074 76.8056 20.074C77.3749 20.074 77.8649 20.1673 78.2756 20.354C78.6956 20.5313 79.0222 20.788 79.2556 21.124C79.4982 21.46 79.6196 21.8613 79.6196 22.328C79.6196 22.7387 79.5169 23.1167 79.3116 23.462C79.1062 23.798 78.7842 24.1153 78.3456 24.414C77.9162 24.7127 77.3516 25.016 76.6516 25.324C76.1756 25.5387 75.7976 25.7487 75.5176 25.954C75.2469 26.15 75.0509 26.3507 74.9296 26.556C74.8082 26.7613 74.7476 26.99 74.7476 27.242C74.7476 27.4753 74.8176 27.6853 74.9576 27.872C75.1069 28.0587 75.3122 28.2033 75.5736 28.306C75.8349 28.4087 76.1429 28.46 76.4976 28.46C77.0669 28.46 77.5896 28.3293 78.0656 28.068C78.5416 27.7973 78.9429 27.4007 79.2696 26.878C79.6056 26.346 79.8436 25.702 79.9836 24.946L81.7336 25.492C81.5376 26.444 81.1876 27.27 80.6836 27.97C80.1796 28.67 79.5589 29.2113 78.8216 29.594C78.0842 29.9767 77.2582 30.168 76.3436 30.168ZM87.414 30V20.2H91.656C92.5333 20.2 93.2893 20.3447 93.924 20.634C94.5586 20.914 95.0486 21.32 95.394 21.852C95.7393 22.384 95.912 23.0187 95.912 23.756C95.912 24.484 95.7393 25.114 95.394 25.646C95.0486 26.178 94.5586 26.5887 93.924 26.878C93.2893 27.158 92.5333 27.298 91.656 27.298H88.674L89.682 26.276V30H87.414ZM89.682 26.528L88.674 25.45H91.53C92.23 25.45 92.7526 25.3007 93.098 25.002C93.4433 24.7033 93.616 24.288 93.616 23.756C93.616 23.2147 93.4433 22.7947 93.098 22.496C92.7526 22.1973 92.23 22.048 91.53 22.048H88.674L89.682 20.97V26.528ZM99.6171 24.148H104.335V25.912H99.6171V24.148ZM99.7851 28.18H105.119V30H97.5311V20.2H104.937V22.02H99.7851V28.18ZM106.924 30V20.2H111.166C112.043 20.2 112.799 20.3447 113.434 20.634C114.068 20.914 114.558 21.32 114.904 21.852C115.249 22.384 115.422 23.0187 115.422 23.756C115.422 24.484 115.249 25.114 114.904 25.646C114.558 26.1687 114.068 26.57 113.434 26.85C112.799 27.13 112.043 27.27 111.166 27.27H108.184L109.192 26.276V30H106.924ZM113.154 30L110.704 26.444H113.126L115.604 30H113.154ZM109.192 26.528L108.184 25.464H111.04C111.74 25.464 112.262 25.3147 112.608 25.016C112.953 24.708 113.126 24.288 113.126 23.756C113.126 23.2147 112.953 22.7947 112.608 22.496C112.262 22.1973 111.74 22.048 111.04 22.048H108.184L109.192 20.97V26.528ZM117.219 30V20.2H119.487V28.152H124.401V30H117.219ZM125.668 30V20.2H127.936V30H125.668ZM130.262 30V20.2H132.138L137.92 27.256H137.01V20.2H139.25V30H137.388L131.592 22.944H132.502V30H130.262ZM141.568 30V20.2H143.836V30H141.568Z"
                  fill="white"
                />
                <defs>
                  <linearGradient
                    id="paint0_linear_2601_10951"
                    x1="297.581"
                    y1="-9.69491"
                    x2="279.697"
                    y2="133.42"
                    gradientUnits="userSpaceOnUse"
                  >
                    <stop offset="0.078125" stopColor="#6015EF" />
                    <stop offset="0.213542" stopColor="#4532D1" />
                    <stop offset="0.526042" stopColor="#CB425C" />
                    <stop offset="0.677083" stopColor="#F9BA17" />
                    <stop
                      offset="0.885417"
                      stopColor="#D9D9D9"
                      stopOpacity="0"
                    />
                  </linearGradient>
                </defs>
              </svg>
            </div>
          )}
          {image && (
            <div>
              <Image
                src={getCroppedImageSrc(image)}
                alt={image.alt}
                fill
                priority
                className="object-cover"
                style={{
                  objectPosition: `${getPositionFromHotspot(image?.hotspot)}`,
                }}
              />

              <div className="map__caption__text absolute text-[clamp(1.4rem,5vw,1.4rem)] text-center leading-normal left-0 right-0 px-[2%] xsmall:px-0 w-fit mx-auto small:text-left small:ml-0 small:left-0 small:right-0 top-[104%] ">
                <PortableText value={imageCaptionText} />

                {/* {imageCaptionText} */}
              </div>
            </div>
          )}

          {/* <MapProvider>
              <MapComponent />
            </MapProvider> */}
          <div className="absolute top-0 left-0 w-full h-[1.7rem]">
            <GradientLineThick />
          </div>
          <div className="absolute bottom-0 left-0 w-full h-[1.7rem]">
            <GradientLineThick />
          </div>

          <div className="absolute bottom-0 left-0 h-full w-[1.7rem] hidden small:block">
            <GradientLineVerticalThick />
          </div>
          <div className="hidden overLarge:block absolute bottom-0 right-0 h-full w-[1.7rem]">
            <GradientLineVerticalThick />
          </div>
        </div>
      </div>
    </section>
  );
}
